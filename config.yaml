units:
  $default_width: cx
  $default_height: cy
  $default_padding: cy
  $default_spread: cx
  px: $default_width + 2
  py: $default_height + 2
  case_height: 25
  xiao_w: 17.8
  xiao_y: xiao_w + 2
  xiao_h: 21
  xiao_usb: 2
points:
  key:
    autobind:
  zones:
    matrix:
      anchor:
        rotate: -15
        shift: [ 100, -100 ]
      columns:
        aussen:
          key:
            column_net: P0
        klein:
          key:
            column_net: P1
        ring:
          key:
            column_net: P2
            stagger: cy
        mittel:
          key:
            column_net: P3
            stagger: .5cy
        zeige:
          key:
            column_net: P4
            stagger: -4
        innen:
          key:
            column_net: P5
      rows:
        unten:
          row_net: P10
        mitte:
          row_net: P9
        oben:
          row_net: P8
        zahlen:
          row_net: P7
    daumen:
      anchor:
        ref: matrix_innen_unten
        shift: [-2cx, -2cy]
        rotate: -15
      columns:
        null:
          rows.unten.skip: true
          key:
            column_net: P2
        eins:
          key:
            column_net: P3
        zwei:
          key:
            column_net: P4
        drei:
          rows.unten.skip: true
          key:
            column_net: P5
      rows:
        unten:
          row_net: P6
        oben:
          row_net: P6

outlines:
  keys:
    - what: rectangle
      where: true
      size: [ $default_width, $default_height ]
  board:
    - what: rectangle
      where: /matrix_(aussen|klein).*/
      size: [ px, py ]
    - what: polygon
      operation: add
      points:
        - ref: matrix_mittel_zahlen
          shift: [-3px -5,.5py]
        - ref: matrix_mittel_zahlen
          shift: [2.5px,.5py]
        - ref: daumen_drei_oben
          shift: [.5px,.5py]
        - ref: daumen_drei_oben
          shift: [.5px,-.5py]
        - ref: daumen_zwei_unten
          shift: [.5px,-.5py]
        - ref: matrix_aussen_unten
          shift: [-.5px,-.5py]
      fillet: 3
  combined:
    - name: board
    - name: keys
      operation: subtract
cases:
  case_name:
    - what: outline
      name: board
      extrude: case_height
pcbs:
  ueboard:
    template: kicad8
    outlines:
      main:
        outline: board
    footprints:
      choc_hotswap:
        what: chocv12
        where: true
        params:
          from: "{{column_net}}"
          to: "{{colrow}}"
      diode:
        what: diode
        where: true
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [ 0, -5 ]
      xiao:
        what: xiao
        where:
          ref: matrix_aussen_zahlen
          shift: [1, xiao_y]
          rotate: 90